<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Z.P. Urdu School Tulinj</title>
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png" />
  <link rel="manifest" href="images/site.webmanifest" />
  <style>
    .result-card {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 70%;
      max-width: 700px;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      .page-content, .page-content * {
        visibility: visible;
      }
      .page-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .img-fluid {
        visibility: visible !important;
      }
    }
  </style>
</head>
<body>
  <div class="d-flex flex-column min-vh-100">
    <div class="container flex-grow-1 py-4 text-center page-content">
      <img src="images/school_banner.jpg" style="height: 150px;" class="img-fluid mb-4" alt="Banner Image" />

      <p class="text-center font-weight-bold">
        STUDENT PROGRESS REPORT FINAL EXAM 2024-25
      </p>
      <div class="container text-center">
        <label for="inputRollNumber" class="mb-3">Roll Number</label>&nbsp;
        <input type="text" id="inputRollNumber" class="mb-3" placeholder="Enter Roll Number" />&nbsp;&nbsp;
        <button onclick="showResult()" class="btn btn-primary mb-2" id="btnShowResult">Show Result</button>&nbsp;&nbsp;
        <button onclick="reset()" class="btn btn-secondary mb-2">Clear</button>
      </div>

      <div class="container text-center">
        <div class="row">
          <div class="col"></div>
          <div class="col-10">
            <div id="resultContainer" class="d-flex justify-content-center" aria-live="polite"></div>
          </div>
          <div class="col"></div>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer mt-auto py-3 bg-light text-center text-muted">
    <small>
      Copyright © <span id="year"></span>
      &nbsp; Z.P. Urdu School Tulinj. All rights reserved.
    </small>
  </footer>

  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    document.getElementById("inputRollNumber").addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        document.getElementById("btnShowResult").click();
      }
    });

    function showResult() {
      const rollNumber = document.getElementById("inputRollNumber").value.trim();
      const resultContainer = document.getElementById("resultContainer");

      if (!rollNumber) {
        resultContainer.innerHTML = `<div class="alert alert-warning" role="alert">Please enter a roll number.</div>`;
        return;
      }

      fetch("data/students_result.json")
        .then((response) => response.json())
        .then((data) => {
          const student = data.find(
            (student) => student["Roll No"].toString().toUpperCase() === rollNumber.toUpperCase()
          );

          if (student) {
            const photoPath = `images/photos/${rollNumber.toUpperCase()}.jpeg`;

            let resultHTML = `
              <div class="result-card text-center">
                <img src="${photoPath}" alt="Student Photo" class="img-fluid rounded-circle mb-3"
                     style="width: 125px; height: 125px;" onerror="this.onerror=null; this.src='images/default.jpg';">
                <h4>${student.Name}</h4>
                <p>Roll Number: ${student["Roll No"]}</p>

                <table class="table table-bordered">
                  <thead class="thead-light">
                    <tr class="table-active">
                      <th>Subject</th>
                      <th>Score</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td>Urdu</td><td>${student.Urdu}</td></tr>
                    <tr><td>English</td><td>${student.English}</td></tr>
                    <tr><td>Hindi/Marathi</td><td>${student["Hindi/Marathi"]}</td></tr>
                    <tr><td>Maths</td><td>${student.Maths}</td></tr>
                    <tr><td>Science</td><td>${student.Science}</td></tr>
                    <tr><td>Social Science</td><td>${student["Social Science"]}</td></tr>
                    <tr><td>Art</td><td>${student.Art}</td></tr>
                    <tr><td>Work Experience</td><td>${student["Work Exper."]}</td></tr>
                    <tr><td>Physical Education</td><td>${student.Physical}</td></tr>
                    <tr class="table-active"><th>Total Score</th><td>${student.Total}/360</td></tr>
                    <tr class="table-active"><th>Percentage</th><td>${student.Percentage}%</td></tr>
                    <tr class="table-active"><th>Remarks</th><td>${student.Remark}</td></tr>
                    <tr><td colspan="2"><img src="images/Sign.jpg" alt="Signature" style="max-height: 60px;" onerror="this.style.display='none';" /></td></tr>
                  </tbody>
                </table>

                <button class="btn btn-outline-success mt-3" onclick="downloadPDF()">⬇ Download PDF</button>
              </div>
            `;

            resultContainer.innerHTML = resultHTML;
          } else {
            resultContainer.innerHTML = `<div class="alert alert-danger" role="alert">Student not found. Please check the roll number.</div>`;
          }
        })
        .catch(() => {
          resultContainer.innerHTML = `<div class="alert alert-danger" role="alert">Error fetching data. Please try again later.</div>`;
        });
    }

    function reset() {
      document.getElementById("inputRollNumber").value = "";
      document.getElementById("resultContainer").innerHTML = "";
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pageContent = document.querySelector(".page-content");

      const canvas = await html2canvas(pageContent, {
        useCORS: true,
        allowTaint: false,
        scale: 2,
      });

      const imgData = canvas.toDataURL("image/png");
      const pdf = new jsPDF("p", "pt", "a4");
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
      pdf.save("Student_Report.pdf");
    }
  </script>
</body>
</html>
